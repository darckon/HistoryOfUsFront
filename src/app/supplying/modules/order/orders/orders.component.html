

  <button *ngIf="createModule" routerLink="/supplying/orders/create" mat-button color="primary" style="float:right;">
    <mat-icon>add</mat-icon>Crear nueva orden
  </button>


  <form  [formGroup]="filterGroup" fxLayoutAlign="start" fxLayoutGap="15px"  style="flex-wrap:wrap;margin-bottom: 15px;width: 100%;">


    <mat-expansion-panel style="flex-basis: 100%; flex-grow: 1;">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <b>Filtros</b>
        </mat-panel-title>
      </mat-expansion-panel-header>
    
      <span style="flex-basis: 100%; flex-grow: 1;" >
      
        <span fxLayoutAlign="start" style="flex-wrap:wrap;" >
          <mat-form-field appearance="outline"  style="margin:5px;flex-grow: 1;" class="mobile-form-input" >
            <input matInput [matDatepicker]="picker" placeholder="Fecha de inicio" formControlName='initDateInput'>
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error *ngIf="filterGroup.controls['initDateInput'].hasError('required')">
              Este campo es <strong>obligatorio</strong>
            </mat-error>             
          </mat-form-field>
          <mat-form-field appearance="outline" style="margin:5px; flex-grow: 1;" class="mobile-form-input" >
            <input matInput [matDatepicker]="picker2" placeholder="Fecha de término" formControlName='endDateInput'>
            <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
            <mat-datepicker #picker2></mat-datepicker>
            <mat-error *ngIf="filterGroup.controls['endDateInput'].hasError('required')">
              Este campo es <strong>obligatorio</strong>
            </mat-error>             
          </mat-form-field>
        </span>
   
        <span fxLayoutAlign="start" style="flex-wrap:wrap;" >
          <mat-form-field appearance="outline"  style="margin:5px; flex-grow: 1;" class="mobile-form-input" >
            <mat-label>Origen(*) </mat-label>
            <mat-select [hidden]="filterGroup.value.origin" formControlName="origin">

                <mat-option>
                  Sin selección
                </mat-option>

                <mat-optgroup label="Bodegas">
                  <mat-option selected="0" *ngFor="let loc of locations" [value]="loc">
                      {{loc.name}}
                  </mat-option>
                </mat-optgroup>

                <mat-optgroup label="Centros de costo">
                  <mat-option selected="0" *ngFor="let loc of costCenters" [value]="loc">
                      {{loc.name}}
                  </mat-option>
                </mat-optgroup>


            </mat-select>
            <mat-chip-list  *ngIf="filterGroup.value?.origin" selected style="height: 10px;width:100%;">
              <mat-chip selected style="height: 10px;width:100%;" removable>
                {{filterGroup.value.origin.name}}
                <mat-icon matChipRemove (click)="removeFilter(filterGroup.get('origin'))">cancel</mat-icon>
              </mat-chip>
            </mat-chip-list>

            <mat-error *ngIf="filterGroup.controls['origin']?.hasError('required')">
            Este campo es <strong>obligatorio</strong>
            </mat-error>
          </mat-form-field>
          <mat-form-field  appearance="outline" style="margin:5px;flex-grow: 1;" class="mobile-form-input" >
              <mat-label *ngIf="!isLoadingDestinations" >Destino(*) </mat-label>
              <mat-label [hidden]="filterGroup.value.destination"  *ngIf="isLoadingDestinations"  ><mat-spinner diameter="20"></mat-spinner></mat-label>
              <mat-select [hidden]="filterGroup.value.destination"   formControlName="destination">
                  <mat-option  *ngFor="let option of (destinations$ | async)?.data" [value]="option">
                    {{option.name}}
                  </mat-option>
              </mat-select>  
              <mat-chip-list *ngIf="filterGroup.value?.destination" selected style="height: 10px;width:100%;">
                <mat-chip selected style="height: 10px;width:100%;" removable>
                  {{filterGroup.value.destination.name}}
                  <mat-icon matChipRemove (click)="removeFilter(filterGroup.get('destination'))">cancel</mat-icon>
                </mat-chip>
              </mat-chip-list>              
              
              <mat-error *ngIf="filterGroup.controls['destination'].hasError('required')">
              Este campo es <strong>obligatorio</strong>
              </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" style="margin:5px; flex-grow: 1;" class="mobile-form-input">
            <input matInput placeholder="Código pedido" formControlName='orderCodeInput'>
          </mat-form-field>

        </span>        

        <span fxLayoutAlign="start" style="flex-wrap:wrap;" >
          <button [disabled]="!filterGroup.valid" style="height: 40px; flex-basis: 10%; flex-grow: 1; " (click)="sendForm()"
            mat-raised-button color="primary">
            <mat-icon>search</mat-icon>
          </button>
        </span>

      </span>
    </mat-expansion-panel>

  </form>

  <mat-tab-group [animationDuration]="0" [selectedIndex]="currentTab" (selectedTabChange)="tabChanged($event)">
    <mat-tab [disabled]="!filterGroup.valid" style="margin:15px;">
      <ng-template mat-tab-label>
        {{ 'SUPPLYING.ORDER._REQUESTED_' | translate }}
      </ng-template>
    </mat-tab>
    <mat-tab style="margin:15px;" [disabled]="!filterGroup.valid">
      <ng-template mat-tab-label>
        {{ 'SUPPLYING.ORDER._TRANSIT_' | translate }}
      </ng-template>
    </mat-tab>
    <mat-tab style="margin:15px;" [disabled]="!filterGroup.valid">
      <ng-template mat-tab-label>
        {{ 'SUPPLYING.ORDER._FINISHED_' | translate }}
      </ng-template>
    </mat-tab>
  </mat-tab-group>
  <div *ngIf="noData == true">
    <h3>No hay datos que mostrar</h3>
  </div>
  <div *ngIf="noData == false">
      <div *ngIf="isLoadingData" style="min-height: 400px;">
        <mat-spinner style="margin:0 auto;" mode="indeterminate"></mat-spinner>
      </div>

      <div *ngIf="!isLoadingData" style="min-height: 400px;margin: 15px;margin-top: 30px;">

          <mat-table *ngIf="this.results.length > 0" [class.isMobile]="isMobile" [dataSource]="dataSource">

              <ng-container cdkColumnDef="id">
                <mat-header-cell md-sort-header *cdkHeaderCellDef>N° pedido</mat-header-cell>
                <mat-cell *cdkCellDef="let element">
                  <p class="table-data">
                    <span class="mobile-label blue">N° pedido:</span>
                    <app-order-info [AllowAuthorize]="true" [order]="element.correlative" [id]="element.id" [detailRoute]="'orders'" ></app-order-info>
                  </p>
                </mat-cell>
              </ng-container>

              <ng-container cdkColumnDef="comment">
                <mat-header-cell md-sort-header *cdkHeaderCellDef>Comentario</mat-header-cell>
                <mat-cell *cdkCellDef="let element">
                  <p class="table-data">
                    <span class="mobile-label blue">Comentario:</span>
                    {{element.comment}}
                  </p>
                </mat-cell>
              </ng-container>
          
     
              <ng-container cdkColumnDef="status">
                <mat-header-cell md-sort-header *cdkHeaderCellDef>Estado movimiento</mat-header-cell>
                <mat-cell *cdkCellDef="let element">
                  <p class="table-data">
                    <span class="mobile-label blue">Estado movimiento:</span>
                    {{element.movement_state_name }}
                  </p>
                </mat-cell>
              </ng-container>

              <ng-container cdkColumnDef="origin_name">
                <mat-header-cell md-sort-header *cdkHeaderCellDef>Origen</mat-header-cell>
                <mat-cell *cdkCellDef="let element">
                  <p class="table-data">
                    <span class="mobile-label blue">Origen:</span>
                    {{element.destination_name }}
                  </p>
                </mat-cell>
              </ng-container>

              <ng-container cdkColumnDef="destination_name">
                <mat-header-cell md-sort-header *cdkHeaderCellDef>Destino</mat-header-cell>
                <mat-cell *cdkCellDef="let element">
                  <p class="table-data">
                    <span class="mobile-label blue">Destino:</span>
                    {{element.origin_name }}
                  </p>
                </mat-cell>
              </ng-container>

              <ng-container cdkColumnDef="created_at">
                  <mat-header-cell md-sort-header *cdkHeaderCellDef>Creado en</mat-header-cell>
                  <mat-cell *cdkCellDef="let element">
                    <p class="table-data">
                      <span class="mobile-label blue">Creado en:</span>
                      {{element.created_at | date:'shortDate' }}
                    </p>
                  </mat-cell>
                </ng-container>              

              <ng-container cdkColumnDef="actions">
                <mat-header-cell md-sort-header *cdkHeaderCellDef> </mat-header-cell>
                <mat-cell *cdkCellDef="let element">
                  <span class="mobile-label blue"><b>Opciones:</b></span>
                  <button *ngIf="priv_detail" matTooltip="Detalle" mat-button color="primary" routerLink="/supplying/orders/detail/{{element.id}}/">
                    <mat-icon>assignment</mat-icon>
                  </button>
                </mat-cell>
              </ng-container>
          
              <mat-header-row *cdkHeaderRowDef="displayedColumns"></mat-header-row>
              <mat-row *cdkRowDef="let row; columns: displayedColumns;"></mat-row>
          </mat-table>
  
          <h3 *ngIf="this.results?.length == 0"> <b>No hay datos que mostrar</b></h3>

      </div>


      

  </div>

  <mat-paginator  [length]="pageNumber" [hidePageSize]="true" [pageSizeOptions]="[10]" (page)="loadPageData()"
  showFirstLastButtons></mat-paginator>

